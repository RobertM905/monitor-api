{
  "$schema": "http://json-schema.org/draft-07/schema",
  "title": "AC Project",
  "type": "object",
  "sharedData": [
    {
      "from": [
        "milestones",
        "dates",
        "surveysAndDueDiligence",
        "commencementOfDueDiligence"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "commencementOfDueDiligence"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "surveysAndDueDiligence",
        "completionOfSurveysHolder",
        "completionOfSurveys"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "completionOfSurveys"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "procurementProvision",
        "procurementOfWorksCommencementDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "procurementOfWorksCommencementDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "procurementProvision",
        "provisionOfDetailedWorksHolder",
        "provisionOfDetailedWorks"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "provisionOfDetailedWorks"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "worksDate",
        "commencementDateHolder",
        "commencementDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "commencementDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "worksDate",
        "completionDateHolder",
        "completionDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "completionDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "outlinePlanning",
        "outlinePlanningGrantedDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "outlinePlanningGrantedDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "outlinePlanning",
        "reservedMatterPermissionGrantedDateHolder",
        "reservedMatterPermissionGrantedDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "reservedMatterPermissionGrantedDate"
      ]
    },
    {
      "from": ["milestones", "dates", "marketingCommenced"],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "marketingCommenced"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "contractSigned",
        "conditionalContractSignedHolder",
        "conditionalContractSigned"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "conditionalContractSigned"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "contractSigned",
        "unconditionalContractSignedHolder",
        "unconditionalContractSigned"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "unconditionalContractSigned"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "workDates",
        "startOnSiteDateHolder",
        "startOnSiteDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "startOnSiteDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "workDates",
        "startOnFirstUnitDateHolder",
        "startOnFirstUnitDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "startOnFirstUnitDate"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "completionDates",
        "completionOfFinalUnitDateHolder",
        "completionOfFinalUnitData"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "completionOfFinalUnitData"
      ]
    },
    {
      "from": [
        "milestones",
        "dates",
        "completionDates",
        "projectCompletionDate"
      ],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "projectCompletionDate"
      ]
    },
    {
      "from": ["milestones", "dates", "customMileStones"],
      "to": [
        "summary",
        "sitesSummary",
        "#",
        "hiddenMilestones",
        "customMileStones"
      ]
    },
    {
      "from": ["outputs", "mmcCategory"],
      "to": ["summary", "sitesSummary", "#", "hiddenMmcCategory"]
    },
    {
      "from": ["outputs", "keyProgrammeObjectives", "schemePace"],
      "to": ["summary", "sitesSummary", "#", "hiddenSchemePace"]
    }
  ],
  "properties": {
    "summary": {
      "type": "object",
      "title": "Project Summary",
      "properties": {
        "localAuthority": {
          "type": "string",
          "title": "Local Authority"
        },
        "projectName": {
          "type": "string",
          "title": "Project Name"
        },
        "projectRef": {
          "type": "string",
          "title": "Project reference"
        },
        "projectDescription": {
          "type": "string",
          "title": "Project Description",
          "extendedText": true
        },
        "sitesSummary": {
          "type": "array",
          "addable": true,
          "title": "Site(s)",
          "items": {
            "type": "object",
            "properties": {
              "hiddenMilestones": {
                "type": "object",
                "title": "",
                "properties": {
                  "commencementOfDueDiligence": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "completionOfSurveys": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "procurementOfWorksCommencementDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "provisionOfDetailedWorks": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "commencementDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "completionDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "outlinePlanningGrantedDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "reservedMatterPermissionGrantedDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "marketingCommenced": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "conditionalContractSigned": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "unconditionalContractSigned": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "startOnSiteDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "startOnFirstUnitDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "completionOfFinalUnitData": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "projectCompletionDate": {
                    "type": "string",
                    "title": "",
                    "hidden": true
                  },
                  "customMileStones": {
                    "type": "array",
                    "title": "",
                    "items": {
                      "type": "object",
                      "title": "",
                      "properties": {
                        "customTitle": {
                          "type": "string",
                          "hidden": true,
                          "title": "Milestone"
                        },
                        "customDate": {
                          "type": "string",
                          "title": "Date",
                          "hidden": true,
                          "format": "date"
                        }
                      }
                    }
                  }
                }
              },
              "hiddenMmcCategory": {
                "title": "MMC Category",
                "type": "object",
                "properties": {
                  "catA": {
                    "type": "string",
                    "hidden": true,
                    "title": "Category A - Volumetric",
                    "percentage": true
                  },
                  "catB": {
                    "type": "string",
                    "hidden": true,
                    "title": "Category B - Hybrid",
                    "percentage": true
                  },
                  "catC": {
                    "type": "string",
                    "hidden": true,
                    "title": "Category C - Panellised",
                    "percentage": true
                  },
                  "catD": {
                    "type": "string",
                    "hidden": true,
                    "title": "Category D -  Sub-Assemblies and Components",
                    "percentage": true
                  },
                  "catE": {
                    "type": "string",
                    "hidden": true,
                    "title": "Category E - Non-OSM/MMC Construction",
                    "percentage": true
                  }
                }
              },
              "hiddenSchemePace": {
                "type": "string",
                "hidden": true,
                "title": "Scheme Pace (units pm)",
                "currencyMaximum": "99999"
              },
              "innerSummary": {
                "type": "object",
                "title": "",
                "properties": {
                  "name": {
                    "type": "string",
                    "title": "Parcel/Sub Site name"
                  },
                  "details": {
                    "type": "object",
                    "horizontal": true,
                    "properties": {
                      "ref": {
                        "type": "string",
                        "title": "LMT / GIS ref"
                      },
                      "size": {
                        "type": "string",
                        "title": "Size (Ha)"
                      }
                    }
                  },
                  "planningStatus": {
                    "type": "string",
                    "title": "Planning status",
                    "enum": [
                      "Not in allocated for housing in Local Plan",
                      "Provisional allocation for housing",
                      "Allocated for housing in Local Plan",
                      "Outline or Reserved Matters consent granted"
                    ]
                  },
                  "incomeReceived": {
                    "type": "string",
                    "title": "Income received by the local authority to date",
                    "currency": true
                  },
                  "finalIncome": {
                    "type": "string",
                    "title": "Expected final income for the local authority",
                    "currency": true
                  },
                  "contacts": {
                    "type": "object",
                    "horizontal": true,
                    "properties": {
                      "laContact": {
                        "type": "string",
                        "title": "Key local authority contact email",
                        "format": "email"
                      },
                      "heContact": {
                        "type": "string",
                        "title": "Key Homes England contact email",
                        "format": "email"
                      }
                    }
                  }
                }
              },
              "units": {
                "type": "object",
                "calculation": "set(formData, 'numberOfUnitsTotal', get(formData, 'numberOfUnits') ? parseMoney(get(formData, 'numberOfUnits', 'numberOfUnitsMarket')) + parseMoney(get(formData, 'numberOfUnits', 'numberOfUnitsSharedOwnership')) + parseMoney(get(formData, 'numberOfUnits', 'numberOfUnitsAffordable')) + parseMoney(get(formData, 'numberOfUnits', 'numberOfUnitsPRS')) + parseMoney(get(formData, 'numberOfUnits', 'numberOfUnitsOther')): 0);",
                "title": "",
                "properties": {
                  "numberOfUnits": {
                    "type": "object",
                    "title": "Number of:",
                    "horizontal": true,
                    "properties": {
                      "numberOfUnitsMarket": {
                        "type": "string",
                        "title": "Market sale"
                      },
                      "numberOfUnitsSharedOwnership": {
                        "type": "string",
                        "title": "Shared ownership"
                      },
                      "numberOfUnitsAffordable": {
                        "type": "string",
                        "title": "Affordable/social rent"
                      },
                      "numberOfUnitsPRS": {
                        "type": "string",
                        "title": "Private Rented"
                      },
                      "numberOfUnitsOther": {
                        "type": "string",
                        "title": "Other"
                      }
                    }
                  },
                  "numberOfUnitsTotal": {
                    "type": "string",
                    "title": "Total number of units",
                    "readonly": true
                  }
                }
              }
            }
          }
        }
      }
    },
    "conditions": {
      "type": "object",
      "title": "Conditions",
      "properties": {
        "predrawdownConditions": {
          "type": "object",
          "title": "Pre-Drawdown Conditions",
          "properties": {
            "conditions": {
              "title": "",
              "type": "array",
              "numbered": true,
              "addable": true,
              "items": {
                "type": "object",
                "properties": {
                  "conditionName": {
                    "type": "string",
                    "title": "Condition Name"
                  },
                  "conditionExplanation": {
                    "type": "string",
                    "title": "Condition explanation"
                  }
                }
              }
            }
          }
        },
        "fundingItems": {
          "type": "object",
          "title": "Funding Items",
          "properties": {
            "fundItems": {
              "title": "",
              "type": "array",
              "addable": true,
              "items": {
                "type": "object",
                "properties": {
                  "itemToFund": {
                    "title": "",
                    "type": "object",
                    "horizontal": true,
                    "properties": {
                      "fundingItem": {
                        "type": "string",
                        "title": "Funding item",
                        "extendedText": true
                      },
                      "estimatedFunding": {
                        "type": "string",
                        "title": "Estimated funding",
                        "currency": "true",
                        "currencyMaximum": "99999999"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "financials": {
      "type": "object",
      "title": "Financials",
      "properties": {
        "expenditure": {
          "type": "array",
          "quarterly": true,
          "addable": true,
          "title": "Funding Drawdown",
          "items": {
            "type": "object",
            "properties": {
              "year": {
                "type": "string",
                "title": "Year",
                "enum": ["2018/19", "2019/20", "2020/21"]
              },
              "Q1Amount": {
                "type": "string",
                "title": "First Quarter",
                "currency": true
              },
              "Q2Amount": {
                "type": "string",
                "title": "Second Quarter",
                "currency": true
              },
              "Q3Amount": {
                "type": "string",
                "title": "Third Quarter",
                "currency": true
              },
              "Q4Amount": {
                "type": "string",
                "title": "Fourth Quarter",
                "currency": true
              }
            }
          }
        },
        "receipts": {
          "type": "object",
          "title": "Receipts",
          "calculation": "set(formData, 'projectValue', accumulateMoney(get(formData, 'expectedDisposalReceipt'), 'amount'));",
          "properties": {
            "detailsOnPaymentStructure": {
              "type": "string",
              "title": "Details on payment structure"
            },
            "expectedDisposalReceipt": {
              "type": "array",
              "addable": true,
              "quarterly": true,
              "title": "",
              "items": {
                "type": "object",
                "properties": {
                  "site": {
                    "type": "string",
                    "title": "Site Name"
                  },
                  "amount": {
                    "type": "string",
                    "title": "Projected (clean site) value",
                    "currency": true
                  }
                }
              }
            },
            "projectValue": {
              "type": "string",
              "title": "Total projected (clean site) value",
              "currency": true,
              "currencyMaximum": "99999999",
              "readonly": true
            },
            "clawback": {
              "type": "string",
              "title": "Clawback",
              "percentage": true,
              "currencyMaximum": "9999"
            }
          }
        }
      }
    },
    "milestones": {
      "type": "object",
      "title": "Milestones",
      "properties": {
        "dates": {
          "type": "object",
          "title": "",
          "calculation": "validateDatesSequential(formData, ['surveysAndDueDiligence', 'commencementOfDueDiligence'], ['surveysAndDueDiligence','completionOfSurveysHolder','completionOfSurveys']); validateDatesSequential(formData, ['procurementProvision', 'procurementOfWorksCommencementDate'], ['procurementProvision','provisionOfDetailedWorksHolder','provisionOfDetailedWorks'], ['worksDate', 'commencementDateHolder', 'commencementDate'], ['worksDate', 'completionDateHolder', 'completionDate']); validateDatesSequential(formData, ['outlinePlanning', 'outlinePlanningGrantedDate'], ['outlinePlanning','reservedMatterPermissionGrantedDateHolder','reservedMatterPermissionGrantedDate']); validateDatesSequential(formData, ['marketingCommenced'], ['contractSigned','conditionalContractSignedHolder','conditionalContractSigned'], ['contractSigned', 'unconditionalContractSignedHolder', 'unconditionalContractSigned'], ['workDates', 'startOnSiteDateHolder', 'startOnSiteDate'], ['workDates', 'startOnFirstUnitDateHolder', 'startOnFirstUnitDate'], ['completionDates', 'completionOfFinalUnitDateHolder', 'completionOfFinalUnitData']);",
          "properties": {
            "surveysAndDueDiligence": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "commencementOfDueDiligence": {
                  "type": "string",
                  "format": "date",
                  "title": "Commencement of surveys and due diligence"
                },
                "completionOfSurveysHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the commencement of surveys and due diligence.",
                  "properties": {
                    "completionOfSurveys": {
                      "type": "string",
                      "format": "date",
                      "title": "Completion of surveys and due diligence"
                    }
                  }
                }
              }
            },
            "procurementProvision": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "procurementOfWorksCommencementDate": {
                  "type": "string",
                  "format": "date",
                  "title": "Procurement of works commencement date"
                },
                "provisionOfDetailedWorksHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the procurement of works commencement.",
                  "properties": {
                    "provisionOfDetailedWorks": {
                      "type": "string",
                      "format": "date",
                      "title": "Provision of detailed works specification and milestones"
                    }
                  }
                }
              }
            },
            "worksDate": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "commencementDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the provision of detailed works specification and milestones.",
                  "properties": {
                    "commencementDate": {
                      "type": "string",
                      "format": "date",
                      "title": "Commencement of works date (first, if multiple)"
                    }
                  }
                },
                "completionDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the commencement of works.",
                  "properties": {
                    "completionDate": {
                      "type": "string",
                      "format": "date",
                      "title": "Completion of works date (last, if multiple)"
                    }
                  }
                }
              }
            },
            "outlinePlanning": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "outlinePlanningGrantedDate": {
                  "type": "string",
                  "format": "date",
                  "title": "Outline planning permission granted date"
                },
                "reservedMatterPermissionGrantedDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the outline planning permission is granted.",
                  "properties": {
                    "reservedMatterPermissionGrantedDate": {
                      "type": "string",
                      "format": "date",
                      "title": "Reserved Matter Permission Granted date"
                    }
                  }
                }
              }
            },
            "marketingCommenced": {
              "type": "string",
              "format": "date",
              "title": "Developer Partner marketing commenced (EOI or formal tender)"
            },
            "contractSigned": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "conditionalContractSignedHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the developer partner marketing has commenced.",
                  "properties": {
                    "conditionalContractSigned": {
                      "type": "string",
                      "format": "date",
                      "title": "Conditional contract signed"
                    }
                  }
                },
                "unconditionalContractSignedHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the conditional contract is signed.",
                  "properties": {
                    "unconditionalContractSigned": {
                      "type": "string",
                      "format": "date",
                      "title": "Unconditional contract signed"
                    }
                  }
                }
              }
            },
            "workDates": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "startOnSiteDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the unconditional contract is signed.",
                  "properties": {
                    "startOnSiteDate": {
                      "type": "string",
                      "format": "date",
                      "title": "Start on site date"
                    }
                  }
                },
                "startOnFirstUnitDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the start on site.",
                  "properties": {
                    "startOnFirstUnitDate": {
                      "type": "string",
                      "format": "date",
                      "title": "Start of first unit date"
                    }
                  }
                }
              }
            },
            "completionDates": {
              "type": "object",
              "title": "",
              "horizontal": true,
              "properties": {
                "completionOfFinalUnitDateHolder": {
                  "type": "object",
                  "title": "",
                  "validated": true,
                  "invalidText": "This should occur after the start on first unit.",
                  "properties": {
                    "completionOfFinalUnitData": {
                      "type": "string",
                      "title": "Completion of Final Unit Date",
                      "format": "date"
                    }
                  }
                },
                "projectCompletionDate": {
                  "type": "string",
                  "title": "Project Completion Date",
                  "format": "date"
                }
              }
            },
            "customMileStones": {
              "type": "array",
              "addable": true,
              "title": "Custom Milestones",
              "items": {
                "type": "object",
                "properties": {
                  "customTitle": {
                    "type": "string",
                    "title": "Milestone"
                  },
                  "customDate": {
                    "type": "string",
                    "title": "Date",
                    "format": "date"
                  }
                }
              }
            }
          }
        }
      }
    },
    "outputs": {
      "type": "object",
      "title": "Outputs",
      "properties": {
        "keyProgrammeObjectives": {
          "type": "object",
          "title": "Key Programme Objectives",
          "horizontal": true,
          "properties": {
            "localMarketPace": {
              "type": "string",
              "title": "Local Market Pace (units pm)",
              "currencyMaximum": "99999"
            },
            "schemePace": {
              "type": "string",
              "title": "Scheme Pace (units pm)",
              "currencyMaximum": "99999"
            }
          }
        },
        "mmcCategory": {
          "title": "MMC Category",
          "type": "object",
          "properties": {
            "catA": {
              "type": "string",
              "title": "Category A - Volumetric",
              "percentage": true
            },
            "catB": {
              "type": "string",
              "title": "Category B - Hybrid",
              "percentage": true
            },
            "catC": {
              "type": "string",
              "title": "Category C - Panellised",
              "percentage": true
            },
            "catD": {
              "type": "string",
              "title": "Category D -  Sub-Assemblies and Components",
              "percentage": true
            },
            "catE": {
              "type": "string",
              "title": "Category E - Non-OSM/MMC Construction",
              "percentage": true
            }
          }
        }
      }
    }
  }
}
